#summary Using Scripts
#sidebar wSb

==Using Scripts==

*<font color="red">Most Tunnelblick users do not need to use the information on this page; Tunnelblick uses scripts automatically.</font>*

*All scripts are run as root* so they can make network configuration changes; thus caution is advised when modifying these scripts or using customized scripts.

Tunnelblick uses three types of scripts: Tunnelblick VPN Configuration scripts, up- and down- scripts, and the leasewatch script.

The up script and the connected.sh script are both run when a connection is made; the order in which they are run is not defined.

The down script and the post-disconnect.sh script are both run when a configuration is disconnected; the order in which they are run is not defined.

*Tunnelblick VPN Configuration scripts* shell scripts that are run by Tunnelblick at particular points in the connection process.
 * They are only available in [wPkgs Tunnelblick VPN Configurations] (available in Tunnelblick 3.1beta06 or later).
 * Tunnelblick does not include any of these scripts; see the [DownloadsEntry Downloads page] for user-contributed scripts.
 * They may be used in special circumstances -- for example, to make modifications to the network configuration when a tunnel is active.
 * The post-disconnect script is not run unless Tunnelblick is running at the time the disconnection occurs. (This may not be the case for 'connect when computer starts' configurations.)
 * The following scripts may be used (they must have these exact names):
   * *pre-connect.sh* is executed (as root) before Tunnelblick would unload and/or load the tun or tap kexts (whether or not any unload or load takes place).
   * *post-tun-tap-load.sh* is executed (as root) after Tunnelblick unloads and/or loads the tun or tap kexts (whether or not any unload or load takes place). Thus, the script is executed immediately before starting OpenVPN. Available in Tunnelblick 3.2beta02 and later only.
   * *connected.sh* is executed (as root) when a configuration connects. This script is executed only if Tunnelblick is running at the time of the event, which may not be the case for 'when computer starts' configurations. Available in Tunnelblick 3.2beta02 and later only.
   * *reconnecting.sh* is executed (as root) when OpenVPN loses the VPN connection and is trying to reconnect. This script is executed only if Tunnelblick is running at the time of the event, which may not be the case for 'when computer starts' configurations. Available in Tunnelblick 3.2beta02 and later only.
   * *post-disconnect.sh* is executed (as root) after OpenVPN has closed the connection. This script is executed only if Tunnelblick is running at the time of the event, which may not be the case for 'when computer starts' configurations.

*up- and down- scripts* are shell scripts that are run by OpenVPN immediately after connecting, and immediately after disconnecting, respectively. 
  * The scripts are run only when "Set nameserver" is selected.
  * To run the scripts, Tunnelblick passes OpenVPN "--up", "--down" options. This means that any "up" or "down" options specified in the OpenVPN configuration file are ignored. To use your own custom scripts from within the configuration file, select "Do not set nameserver".
  * Tunnelblick includes a standard up script and a standard down script (client.up.tunnelblick.sh and client.down.tunnelblick.sh, respectively) that are used if no other scripts are present. They are located in Tunnelblick.app/Contents/Resources. The scripts save the current DNS configuration and accept "pushed" configurations from the VPN server when the VPN is connected, and restore the DNS configurations when the VPN is disconnected. If "Monitor connection" is checked, the up script sets up to run the leasewatch script when a network configuration change is detected.
  * The up and down scripts may be called with optional arguments (before the standard OpenVPN-supplied arguments) that are prefixed by a '-'. The arguments are:
    * -m to monitor the network configuration (reflects the 'Monitor connection' checkbox);
    * -w to cause restoration of expected WINS configuration if it changes to the pre-VPN configuration (via DHCP renewal, for example); and
    * -d to cause restoration of expected  DNS configuration if it changes to the pre-VPN configuration (via DHCP renewal, for example).
  * The -w and -d options are specified if the boolean Tunnelblick preferences '-doNotRestoreOnDnsReset' and/or '-doNotRestoreOnWinsReset' are TRUE.
  * In a [wCusDeployed "Deployed" version] of Tunnelblick, the standard scripts may be overridden by including "up.tunnelblick.sh" and "down.tunnelblick.sh" scripts in Tunnelblick.app/Contents/Resources/Deploy.
  * The standard scripts and Deployed scripts may be overridden by including "up.tunnelblick.sh" and "down.tunnelblick.sh" scripts in a [wPkgs Tunnelblick VPN Configuration].
  * For backward compatibility, deprecated scripts named "up.sh", "down.sh", "nomonitor.up.sh", "nomonitor.down.sh" will override any other scripts.


*leasewatch* is a script that is run when a VPN is connected, "Monitor connections" is checked for the configuration, and a network configuration change is detected. It ignores the change, restarts the connection, or restores the VPN's DNS and WINS configuration as appropriate. It is located in Tunnelblick.app/Contents/Resources/leasewatch.

------------------

===PLEASE USE THE [http://groups.google.com/group/tunnelblick-discuss TUNNELBLICK DISCUSSION GROUP] FOR COMMENTS OR QUESTIONS*===