#summary Using Scripts
#sidebar wSb

==Using Scripts==

*<font color="red">Most Tunnelblick users do not need to use the information on this page; Tunnelblick uses scripts automatically.</font>*

*All scripts are run as root* so they can make network configuration changes; thus caution is advised when modifying these scripts or using customized scripts.

Tunnelblick uses three types of scripts: pre- and post- scripts, up- and down- scripts, and the leasewatch script.

*pre- and post- scripts* are run before kexts (device drivers) are loaded and OpenVPN is started, and after OpenVPN has stopped and kexts are unloaded, respectively.
  * Tunnelblick does not include any of these scripts; see the [DownloadsEntry Downloads page] for user-contributed scripts.
  * They may be used in special circumstances -- for example, to make modifications to the network configuration when a tunnel is active.
  * The scripts must be named "pre-connect.sh" and "post-disconnect.sh"
  * The scripts can only be used in a [wPkgs Tunnelblick VPN Configuration] when using Tunnelblick 3.1beta06 or later.
  * The post-disconnect script is not run unless Tunnelblick is running at the time the disconnection occurs. (This only affects 'connect when computer starts' configurations.)

*up- and down- scripts* are run immediately after connecting, and immediately after disconnecting, respectively. 
  * The scripts are run only when "Set nameserver" is selected.
  * To run the scripts, Tunnelblick passes OpenVPN "--up", "--down" options. This means that any "up" or "down" options specified in the OpenVPN configuration file are ignored. To use your own custom scripts from within the configuration file, select "Do not set nameserver".
  * Tunnelblick includes a standard up script and a standard down script (client.up.tunnelblick.sh and client.down.tunnelblick.sh, respectively) that are used if no other scripts are present. They are located in Tunnelblick.app/Contents/Resources. The scripts save the current DNS configuration and accept "pushed" configurations from the VPN server when the VPN is connected, and restore the DNS configurations when the VPN is disconnected. If "Monitor connection" is checked, the up script sets up to run the leasewatch script when a network configuration change is detected.
  * The up and down scripts may be called with optional arguments (before the standard OpenVPN-supplied arguments) that are prefixed by a '-'. The arguments are:
    * -m to monitor the network configuration (reflects the 'Monitor connection' checkbox);
    * -w to cause restoration of expected WINS configuration if it changes to the pre-VPN configuration (via DHCP renewal, for example); and
    * -d to cause restoration of expected  DNS configuration if it changes to the pre-VPN configuration (via DHCP renewal, for example).
  * The -w and -d options are specified if the boolean Tunnelblick preferences '-doNotRestoreOnDnsReset' and/or '-doNotRestoreOnWinsReset' are TRUE.
  * In a [wCusDeployed "Deployed" version] of Tunnelblick, the standard scripts may be overridden by including "up.tunnelblick.sh" and "down.tunnelblick.sh" scripts in Tunnelblick.app/Contents/Resources/Deploy.
  * The standard scripts and Deployed scripts may be overridden by including "up.tunnelblick.sh" and "down.tunnelblick.sh" scripts in a [wPkgs Tunnelblick VPN Configuration].
  * For backward compatibility, deprecated scripts named "up.sh", "down.sh", "nomonitor.up.sh", "nomonitor.down.sh" will override any other scripts.


*leasewatch* is a script that is run when a VPN is connected, "Monitor connections" is checked for the configuration, and a network configuration change is detected. It ignores the change, restarts the connection, or restores the VPN's DNS and WINS configuration as appropriate. It is located in Tunnelblick.app/Contents/Resources/leasewatch.

------------------

===PLEASE USE THE [http://groups.google.com/group/tunnelblick-discuss TUNNELBLICK DISCUSSION GROUP] FOR COMMENTS OR QUESTIONS*===